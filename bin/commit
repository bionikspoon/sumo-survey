#! /usr/bin/env bash

set -o errexit -o nounset

git add --force --all .
git update-index
treeSha=$(git write-tree)
name=${TRAVIS_BRANCH:-'master'}
read hash ref <<<$(git show-ref --heads $name)
commitSha=$(git commit-tree -p $ref -m "Commit build products" $treeSha)
diff=$(git diff --quiet $commitSha)
[ -z "$diff" ] && exit 1
git update-ref $ref $commitSha
exit 0

